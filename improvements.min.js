console.log("üöÄ Improvements page loaded");const data=sessionStorage.getItem("cvAnalysisResult");if(console.log("üì¶ SessionStorage data:",data?"FOUND!":"NOT FOUND!"),data)try{const e=JSON.parse(data);console.log("‚úÖ Data parsed successfully"),e.coverLetter&&e.recruiterTips&&e.changesOverview?(console.log("üì¶ Complete data found - using full display"),displayContent(e)):(console.log("‚ö° Fast mode detected - lazy loading content"),displayContentLazy(e))}catch(e){console.error("‚ùå Error parsing data:",e),showError()}else console.error("‚ùå ERROR: No data in sessionStorage!"),showError();function showError(){document.body.innerHTML='\n        <div class="container mx-auto px-4 py-16 text-center">\n            <div class="text-8xl mb-6">‚ö†Ô∏è</div>\n            <h1 class="text-4xl font-bold text-red-600 mb-4" data-i18n="no-data-title">No Data Found</h1>\n            <p class="text-gray-600 mb-8 text-lg" data-i18n="no-data">No CV analysis data available.</p>\n            <button onclick="window.location.href=\'index.html\'"\n                    class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white px-8 py-4 rounded-xl font-semibold shadow-lg transition-all hover:scale-105"\n                    data-i18n="back-to-home">\n                üè† Back to Home\n            </button>\n        </div>\n    '}function displayContent(e){console.log("üìù Displaying content...");const t=[e.changesOverview||"",e.improvedCV||"",e.coverLetter||"",e.recruiterTips||""].join("\n\n");console.log("üìè Text length:",t.length);const n=extractStats(t,e);console.log("üìä Extracted stats:",n),updateStats(n.matchScore,n.changesCount),updateRateLimitDisplay(e.rateLimit),renderChangesContent(e.changesOverview),renderCVContent(e.improvedCV),"requestIdleCallback"in window?requestIdleCallback(()=>{renderMarkdownContent("coverLetter",e.coverLetter),renderRecruiterTipsChecklist(e.recruiterTips)}):setTimeout(()=>{renderMarkdownContent("coverLetter",e.coverLetter),renderRecruiterTipsChecklist(e.recruiterTips)},100),console.log("üéâ ALL DONE!")}async function displayContentLazy(e){console.log("‚ö° Starting lazy content loading..."),console.log("üìÑ Rendering CV (already available)..."),renderCVContent(e.improvedCV),showSkeletonLoaders();const t=e.metadata||{},{cvText:n,jobDescription:o,language:i}=t;if(!n||!o||!i)return console.error("‚ùå Missing metadata for lazy loading"),void showError();try{loadChangesInBackground(n,e.improvedCV,o,i),setTimeout(()=>loadCoverLetterInBackground(n,o,i),2e3),setTimeout(()=>loadRecruiterTipsInBackground(o,i),5e3)}catch(e){console.error("‚ùå Error in lazy loading:",e)}}function showSkeletonLoaders(){document.getElementById("coverLetter").innerHTML='<div class="animate-pulse"><div class="h-4 bg-gray-200 rounded w-3/4 mb-3"></div><div class="h-4 bg-gray-200 rounded w-full mb-3"></div><div class="h-4 bg-gray-200 rounded w-5/6 mb-3"></div></div>',document.getElementById("recruiterTipsChecklist").innerHTML='<div class="animate-pulse"><div class="h-6 bg-gray-200 rounded w-1/2 mb-4"></div><div class="h-4 bg-gray-200 rounded w-full mb-2"></div><div class="h-4 bg-gray-200 rounded w-full mb-2"></div><div class="h-4 bg-gray-200 rounded w-3/4"></div></div>',document.getElementById("changesContent").innerHTML='<div class="animate-pulse"><div class="h-8 bg-gray-200 rounded w-2/3 mb-4"></div><div class="h-4 bg-gray-200 rounded w-full mb-2"></div><div class="h-4 bg-gray-200 rounded w-full mb-2"></div><div class="h-4 bg-gray-200 rounded w-5/6"></div></div>'}async function loadCoverLetterInBackground(e,t,n){console.log("üì® Loading cover letter in background...");try{const o=await fetch("/.netlify/functions/generate-letter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cvText:e,jobDescription:t,language:n})});if(!o.ok)throw new Error("Letter generation failed");const i=await o.json();console.log("‚úÖ Cover letter loaded!"),renderMarkdownContent("coverLetter",i.coverLetter);const a=JSON.parse(sessionStorage.getItem("cvAnalysisResult"));a.coverLetter=i.coverLetter,sessionStorage.setItem("cvAnalysisResult",JSON.stringify(a))}catch(e){console.error("‚ùå Cover letter loading failed:",e),document.getElementById("coverLetter").innerHTML='<p class="text-red-500">Failed to load cover letter. Please refresh the page.</p>'}}async function loadRecruiterTipsInBackground(e,t){console.log("üí° Loading recruiter tips in background...");try{const n=await fetch("/.netlify/functions/generate-tips",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobDescription:e,language:t})});if(!n.ok)throw new Error("Tips generation failed");const o=await n.json();console.log("‚úÖ Recruiter tips loaded!"),renderRecruiterTipsChecklist(o.recruiterTips);const i=JSON.parse(sessionStorage.getItem("cvAnalysisResult"));i.recruiterTips=o.recruiterTips,sessionStorage.setItem("cvAnalysisResult",JSON.stringify(i))}catch(e){console.error("‚ùå Recruiter tips loading failed:",e),document.getElementById("recruiterTipsChecklist").innerHTML='<p class="text-red-500">Failed to load tips. Please refresh the page.</p>'}}async function loadChangesInBackground(e,t,n,o){console.log("üìù Loading changes analysis in background (4 parallel requests)...");try{const[i,a,r,s]=await Promise.all([fetch("/.netlify/functions/generate-changes-ats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({originalCV:e,improvedCV:t,language:o})}).then(e=>e.json()),fetch("/.netlify/functions/generate-changes-impact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({originalCV:e,improvedCV:t,language:o})}).then(e=>e.json()),fetch("/.netlify/functions/generate-changes-polish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({originalCV:e,improvedCV:t,language:o})}).then(e=>e.json()),fetch("/.netlify/functions/generate-changes-match",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({originalCV:e,improvedCV:t,jobDescription:n,language:o})}).then(e=>e.json())]),l=`## üéØ ATS & Keywords Optimalisatie\n\n${i.atsChanges}\n\n## üí™ Impact & Resultaten\n\n${a.impactChanges}\n\n## ‚ú® Professionele Polish\n\n${r.polishChanges}\n\n## üî• Job Match & Targeting\n\n${s.matchChanges}`;console.log("‚úÖ All changes loaded!"),renderChangesContent(l);const c=JSON.parse(sessionStorage.getItem("cvAnalysisResult"));c.changesOverview=l,sessionStorage.setItem("cvAnalysisResult",JSON.stringify(c));const d=extractStats([l,c.improvedCV,c.coverLetter||"",c.recruiterTips||""].join("\n\n"),c);updateStats(d.matchScore,d.changesCount)}catch(e){console.error("‚ùå Changes loading failed:",e),document.getElementById("changesContent").innerHTML='<p class="text-red-500">Failed to load changes analysis. Please refresh the page.</p>'}}function extractStats(e,t){console.log("üîç Starting stats extraction...");let n=0,o=0;const i=e.match(/###?\s*\d+\./g);if(i&&(o=i.length,console.log(`‚úÖ Found ${o} numbered changes`)),0===o){const t=e.match(/###\s+\d+\./g);t&&(o=t.length,console.log(`‚úÖ Counted ${o} ### headers`))}if(0===o){const t=(e.match(/\*\*Original(:|eel)?\*\*/gi)||[]).length,n=(e.match(/\*\*Verbeterd(:|e)?\*\*/gi)||[]).length;o=Math.min(t,n),console.log(`‚úÖ Found ${o} Original/Verbeterd pairs`)}0===o&&e.length>500&&(o=5,console.log("‚ö†Ô∏è Using fallback: 5 changes"));const a=[/match score[:\s]*(\d+)%/i,/score[:\s]*(\d+)%/i,/(\d+)%\s*match/i,/compatibility[:\s]*(\d+)%/i];for(const t of a){const o=e.match(t);if(o){n=parseInt(o[1]),console.log(`‚úÖ Found match score: ${n}%`);break}}if(0===n){console.log("‚ö†Ô∏è No match score pattern found, calculating...");let t=50;o>0&&(t+=Math.min(3*o,25)),(e.includes("waarom")||e.includes("because"))&&(t+=10),/skills|experience|achievement/i.test(e)&&(t+=5),e.includes("**")&&(t+=5),e.length>2e3&&(t+=5),n=Math.min(t,95),console.log(`üí° Calculated score: ${n}%`)}return{matchScore:n,changesCount:o}}function updateStats(e,t){console.log("üìä Updating stats in UI...");const n=Math.max(40,e-28),o=e-n,i=Math.round(o/n*100);document.getElementById("matchScoreContainer").innerHTML=`\n        <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: center; width: 100%;">\n            <div style="display: flex; align-items: center; gap: 0.75rem;">\n                <div style="text-align: center;">\n                    <div style="font-size: 0.625rem; color: #9ca3af; font-weight: 700; text-transform: uppercase; margin-bottom: 0.25rem;">Was</div>\n                    <div style="font-size: 1.5rem; font-weight: 700; color: #9ca3af; text-decoration: line-through;">${n}%</div>\n                </div>\n                <div style="font-size: 1.5rem; color: #10b981;">‚Üí</div>\n                <div style="text-align: center;">\n                    <div style="font-size: 0.625rem; color: #10b981; font-weight: 700; text-transform: uppercase; margin-bottom: 0.25rem;">Nu</div>\n                    <div style="font-size: 2rem; font-weight: 700; background: linear-gradient(to right, #10b981, #14b8a6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" class="score-animate">${e}%</div>\n                </div>\n            </div>\n            <div style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.25rem 0.75rem; background: #dcfce7; border-radius: 999px;">\n                <svg style="width: 1rem; height: 1rem; color: #10b981;" fill="currentColor" viewBox="0 0 20 20">\n                    <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>\n                </svg>\n                <span style="color: #166534; font-weight: 700; font-size: 0.75rem;">+${o}%</span>\n            </div>\n        </div>\n    `,document.getElementById("matchScoreSubtext").innerHTML=`\n        <span class="text-green-600 font-semibold">${i}% meer kans</span> op interview callback\n    `,updateQualityBadge(e,t);const a=document.getElementById("changesCount");a&&(a.textContent=t,a.classList.remove("skeleton-text")),updateImpactMetrics(e,t,o),e>=85&&showAchievement("ATS Master","Uw CV scoort "+e+"%+ op ATS systemen!"),"function"==typeof window.updateComparisonStats&&window.updateComparisonStats(e),console.log("‚úÖ Stats updated")}function updateImpactMetrics(e,t,n){const o=document.getElementById("impactContainer"),i=document.getElementById("impactTitle"),a=document.getElementById("impactSubtext"),r=Math.round(5*t),s=Math.floor(r/60),l=r%60,c=s>0?`${s}u ${l}m`:`${l} min`;o.innerHTML=`\n        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">\n            <div style="font-size: 3rem; line-height: 1;">\n                ${t}\n            </div>\n            <div style="font-size: 0.875rem; font-weight: 700; color: #10b981; text-transform: uppercase; letter-spacing: 0.05em;">\n                Verbeteringen\n            </div>\n        </div>\n    `,i.innerHTML=`‚è±Ô∏è ${c} werk bespaard`,i.className="text-gray-600 font-semibold text-sm lg:text-base";let d="";d=n>=30?'<span class="text-green-600 font-bold">üíé Elite-level</span> optimalisatie':n>=20?'<span class="text-blue-600 font-bold">üöÄ Major</span> verbetering':n>=10?'<span class="text-purple-600 font-bold">‚ú® Goede</span> upgrade':'<span class="text-gray-600 font-bold">üìà Verfijnd</span> en gepolijst',a.innerHTML=d,a.className="text-xs lg:text-sm mt-1"}function updateQualityBadge(e,t){const n=document.getElementById("qualityBadgeContainer"),o=document.getElementById("qualityLevel"),i=Math.max(40,e-28);let a,r,s,l,c,d;e>=90&&t>=10?(a="Platinum",r="Elite Quality",s="from-gray-300 to-blue-200",l="üíé"):e>=80?(a="Gold",r="Premium Quality",s="from-yellow-400 to-orange-400",l="ü•á"):e>=70?(a="Silver",r="High Quality",s="from-gray-400 to-gray-300",l="ü•à"):(a="Bronze",r="Good Quality",s="from-orange-600 to-yellow-700",l="ü•â"),i>=80?(c="Gold",d="ü•á"):i>=70?(c="Silver",d="ü•à"):(c="Bronze",d="ü•â"),n.innerHTML=`\n        <div style="position: relative;">\n            \x3c!-- Small "before" badge in corner --\x3e\n            <div style="position: absolute; top: -8px; left: -8px; width: 40px; height: 40px; background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.15); z-index: 2; border: 3px solid white;">\n                ${d}\n            </div>\n\n            \x3c!-- Main "after" badge --\x3e\n            <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br ${s} flex items-center justify-center text-4xl shadow-lg score-animate" style="position: relative; z-index: 1;">\n                ${l}\n            </div>\n\n            \x3c!-- Arrow indicator showing upgrade --\x3e\n            <div style="position: absolute; top: 50%; left: -12px; transform: translateY(-50%); font-size: 1rem; z-index: 3;">\n                ‚Üí\n            </div>\n        </div>\n    `,o.innerHTML=`\n        <div>\n            <span class="font-bold text-lg" style="color: #10b981;">${a}</span>\n            <span class="text-sm" style="color: #6b7280;"> ${r}</span>\n        </div>\n        <div style="font-size: 0.7rem; color: #9ca3af; margin-top: 0.25rem; font-weight: 600;">\n            Met alle ${t} wijzigingen\n        </div>\n    `}function showAchievement(e,t){const n=document.getElementById("achievementBanner");document.getElementById("achievementTitle").textContent=e,document.getElementById("achievementDesc").textContent=t,n.classList.remove("hidden"),n.classList.add("animate-bounce-slow"),setTimeout(()=>{n.style.opacity="0",n.style.transition="opacity 0.5s",setTimeout(()=>{n.classList.add("hidden"),n.style.opacity="1"},500)},5e3)}function updateRateLimitDisplay(e){if(!e)return void console.log("‚ö†Ô∏è No rate limit data available");console.log("üìä Updating rate limit display:",e);const t=document.getElementById("rateLimitUsage"),n=document.getElementById("rateLimitSubtext");if(e.isDeveloperMode)t.textContent=`${e.used}/‚àû`,t.style.backgroundImage="linear-gradient(to right, #f59e0b, #eab308)",n.innerHTML="üîì <strong>Developer Mode</strong>",n.style.color="#f59e0b",console.log("üîì Developer mode active");else{t.textContent=`${e.used}/${e.total}`;const o=e.used/e.total*100;t.style.backgroundImage=o>=90?"linear-gradient(to right, #ef4444, #dc2626)":o>=70?"linear-gradient(to right, #f59e0b, #d97706)":"linear-gradient(to right, #10b981, #14b8a6)",n.textContent=`${e.remaining} remaining`,n.style.color="#9ca3af"}console.log("‚úÖ Rate limit display updated")}function animateNumber(e,t,n,o,i=""){const a=(n-t)/(o/16);let r=t;const s=setInterval(()=>{r+=a,(a>0&&r>=n||a<0&&r<=n)&&(r=n,clearInterval(s)),e.textContent=Math.round(r)+i},16)}const categories={ats:{name:"ATS & Keywords",icon:"üéØ",color:"blue",changes:[]},impact:{name:"Impact & Resultaten",icon:"üí™",color:"green",changes:[]},polish:{name:"Professionele Polish",icon:"‚ú®",color:"purple",changes:[]},structure:{name:"Structuur & Leesbaarheid",icon:"üé®",color:"orange",changes:[]},targeting:{name:"Job Match & Targeting",icon:"üî•",color:"red",changes:[]}};function categorizeChange(e,t,n=""){const o=(e+" "+t+" "+n).toLowerCase(),i=n.toLowerCase();return i.match(/ats|keywords|optimalisatie/i)?"ats":i.match(/impact|resultaten|achievements/i)?"impact":i.match(/polish|professionele/i)?"polish":i.match(/structuur|leesbaarheid|readability/i)?"structure":i.match(/job.*match|targeting/i)?"targeting":o.match(/keyword|ats|applicant tracking|seo|search|optimalisatie|zoekwoord/i)?"ats":o.match(/kwantif|cijfer|resultaat|impact|achievement|metric|percentage|increase|ROI|revenue|growth/i)?"impact":o.match(/structuur|layout|format|leesbaarheid|readability|bullet|section|visual|hierarchy/i)?"structure":o.match(/job.*match|targeting|relevance|specifiek|tailored|customized|afstemming/i)?"targeting":(o.match(/polish|professionele|grammatica|spelling|toon|consistency|consistentie|taal|language|formeel|formal/i),"polish")}function updateCategoryScores(e){let t=0,n=0,o=0;console.log("üìä Updating category scores:",e),Object.keys(categories).forEach(i=>{const a=(e[i]||[]).length;o+=a,console.log(`  ${i}: ${a} changes`);const r=Math.max(35,100-12*a),s=95-r,l=document.getElementById(`score-${i}`);l.textContent="+"+s,l.classList.remove("skeleton-text"),l.classList.add("score-animate");const c=document.getElementById(`count-${i}`);c.classList.remove("skeleton-text");const d=document.getElementById(`progress-${i}`);d.classList.remove("progress-bar-loading"),d.classList.add("transition-all","duration-1000"),d.style.width=s+"%";const g=l.parentElement.querySelector(".text-xs");if(g&&(g.textContent="/ 100",g.className="text-xs text-gray-500 font-semibold"),0===a){const e={ats:"Keywords perfect geoptimaliseerd",impact:"Impact sterk gecommuniceerd",polish:"Toon & grammatica uitstekend",structure:"Structuur helder & overzichtelijk",targeting:"Matcht goed met functie"};l.parentElement.innerHTML=`\n                <div style="text-align: right;">\n                    <div style="color: #10b981; font-size: 1.125rem; font-weight: 700; line-height: 1.3;">\n                        ‚úì Perfect!\n                    </div>\n                    <div style="color: #059669; font-size: 0.75rem; margin-top: 0.25rem; line-height: 1.3;">\n                        ${e[i]||"Reeds uitstekend"}\n                    </div>\n                </div>\n            `,c.innerHTML='<span style="color: #10b981; font-weight: 700;">Geen wijzigingen nodig</span>',d.style.width="100%",d.className="h-2 rounded-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-1000";document.getElementById(`level-${i}`).innerHTML='<span style="color: #10b981;">‚úì Al perfect</span>';const t=document.querySelector(`.category-card[data-category="${i}"]`);t&&(t.classList.add("category-disabled"),t.style.cursor="pointer",t.style.opacity="0.8")}else{c.textContent=a,l.className=s>=50?"text-3xl font-bold text-green-600 score-animate":s>=30?"text-3xl font-bold text-yellow-600 score-animate":"text-3xl font-bold text-blue-600 score-animate";const e=document.getElementById(`level-${i}`);e.textContent=s>=55?"üíé Massive Gain":s>=40?"ü•á Major Boost":s>=25?"ü•à Good Improvement":"‚ú® Enhanced"}t+=r,n+=95});const i=Math.round(t/5),a=Math.round(n/5),r=a-i;animateNumber(document.getElementById("overall-score"),0,r,1500,"");const s=document.getElementById("overall-progress-ring"),l=2*Math.PI*56,c=l-r/60*l;setTimeout(()=>{s.style.strokeDashoffset=c},500),window.trackEvent&&window.trackEvent("cv_score_calculated",{overall_improvement:r,original_score:i,optimized_score:a,total_changes:o}),showAchievements(r,o,i,a)}function showAchievements(e,t,n,o){const i=document.getElementById("achievement-badges");i.innerHTML="";const a=[];e>=50&&a.push({icon:"üöÄ",text:"Massive Transformation"}),e>=40&&a.push({icon:"‚≠ê",text:"Major Upgrade"}),e>=30&&a.push({icon:"üíé",text:"Significant Boost"}),t>=12&&a.push({icon:"üèÜ",text:"Fully Optimized"}),o>=90&&a.push({icon:"üéØ",text:"Elite Quality CV"}),a.forEach((e,t)=>{setTimeout(()=>{const t=document.createElement("div");t.className="achievement-badge badge-animate",t.innerHTML=`<span>${e.icon}</span><span>${e.text}</span>`,i.appendChild(t)},200*t)}),a.length>0&&window.trackEvent&&window.trackEvent("achievements_unlocked",{achievement_count:a.length,achievements:a.map(e=>e.text).join(", "),improvement_gain:e,original_score:n,optimized_score:o,total_changes:t}),e>=40&&setTimeout(()=>{createConfetti(),window.trackEvent&&window.trackEvent("confetti_celebration",{improvement_gain:e})},1e3)}function createConfetti(){const e=["#667eea","#764ba2","#f093fb","#4facfe"];for(let t=0;t<50;t++)setTimeout(()=>{const t=document.createElement("div");t.className="confetti",t.style.left=Math.random()*window.innerWidth+"px",t.style.backgroundColor=e[Math.floor(Math.random()*e.length)],t.style.animationDelay=.5*Math.random()+"s",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)},30*t)}let activeCategory=null;function toggleCategory(e){const t=document.querySelector(`.category-card[data-category="${e}"]`);if(t&&t.classList.contains("category-disabled")){const e=document.querySelector(".grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3");if(e){const t=100,n=e.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:n,behavior:"smooth"})}return}if(t.classList.contains("active")){t.classList.remove("active");document.querySelectorAll(".category-group").forEach(e=>{e.style.display="",e.style.order="";const t=e.querySelector(".change-content-collapsible");t&&t.classList.add("expanded")});document.querySelectorAll("#changesContent > div").forEach(e=>{e.style.display="",e.style.order="";const t=e.querySelector('[id^="section-content-"]');e.querySelector('[id^="section-icon-"]');t&&(t.style.maxHeight="")}),window.trackEvent&&window.trackEvent("category_collapsed",{category:e})}else{document.querySelectorAll(".category-card").forEach(e=>{e.classList.remove("active")}),t.classList.add("active");document.querySelectorAll("#changesContent > div").forEach((t,n)=>{const o=t.querySelectorAll(".category-group"),i=Array.from(o).some(t=>t.dataset.category===e);if(i){t.style.display="",t.style.order="-1";const n=t.querySelector('[id^="section-content-"]'),i=t.querySelector('[id^="section-icon-"]');n&&(n.classList.remove("collapsed"),n.classList.add("expanded"),n.style.maxHeight="5000px"),i&&i.classList.add("rotate-180"),o.forEach(t=>{if(t.dataset.category===e){t.style.display="",t.style.order="-1";const e=t.querySelector(".change-content-collapsible");e&&e.classList.add("expanded")}else t.style.display="none"})}else{t.style.display="",t.style.order="999";const e=t.querySelector('[id^="section-content-"]'),n=t.querySelector('[id^="section-icon-"]');e&&(e.classList.remove("expanded"),e.style.maxHeight="0px"),n&&n.classList.remove("rotate-180"),o.forEach(e=>{e.style.display=""})}}),window.trackEvent&&window.trackEvent("category_expanded",{category:e}),setTimeout(()=>{const e=document.getElementById("changesContent");if(e){const t=100,n=e.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:n,behavior:"smooth"})}},150)}}function renderChangesContent(e){if(!e)return console.warn("‚ö†Ô∏è No changes content provided"),void(document.getElementById("changesContent").innerHTML='<p class="text-gray-400 italic">Geen wijzigingen gevonden</p>');console.log("üé® Rendering changes content..."),console.log("üìè Content length:",e.length),console.log("üìù First 300 chars:",e.substring(0,300));const t=document.getElementById("changesContent"),n=e.includes("**Origineel:**")||e.includes("**Original:**")||e.includes("**Verbeterd:**")||e.includes("**Improved:**");if(console.log("üìã Format detected: "+(n?"NEW (with fields)":"OLD (flat)")),console.log(`üìÑ First 300 chars: ${e.substring(0,300)}`),!n)return console.log("üîÑ Using OLD format renderer"),void renderChangesContentOldFormat(e);console.log("‚ú® Using NEW hierarchical format renderer");const o=e.split("\n");let i="",a=0,r=0,s=0,l=null,c=null,d="",g="",m=0;const p={};for(let e of o)if(e=e.trim(),e.match(/^##\s+(?!.*üìä)/)){null!==c&&(d+=`\n                                ${g}\n                            </div>\n                        </div>\n                    </div>\n                `,g="",c=null),null!==l&&(i+=`\n                            ${d}\n                        </div>\n                    </div>\n                </div>\n                `,p[l]=m,d="",m=0),a++,r=0;const t=e.replace(/^##\s+/,"").trim();let n="üìã";t.match(/summary|samenvatting/i)?n="üìù":t.match(/experience|werkervaring/i)?n="üíº":t.match(/skills|vaardigheden/i)?n="üéØ":t.match(/education|opleidingen/i)?n="üéì":t.match(/projects|projecten/i)&&(n="üöÄ"),i+=`\n                <div class="mb-6 bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-purple-100">\n                    <button onclick="toggleSection(${a})" class="w-full px-6 py-5 text-left flex items-center justify-between hover:bg-gradient-to-r hover:from-purple-50 hover:to-indigo-50 transition-all duration-300">\n                        <div class="flex items-center gap-4 flex-1">\n                            <span class="text-3xl">${n}</span>\n                            <div>\n                                <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">${t}</h2>\n                                <p class="text-sm text-gray-500 mt-1" id="section-count-${a}">Laden...</p>\n                            </div>\n                        </div>\n                        <svg id="section-icon-${a}" class="w-7 h-7 text-purple-600 transition-transform duration-300 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>\n                        </svg>\n                    </button>\n                    <div id="section-content-${a}" class="change-content-collapsible expanded">\n                        <div class="p-4 bg-gradient-to-br from-gray-50 to-white">\n            `,l=a}else if(e.match(/^###\s*\d+\./)){null!==c&&(d+=`\n                                ${g}\n                            </div>\n                        </div>\n                    </div>\n                `,g=""),r++,s++,m++;d+=`\n                <div class="change-card-collapsible bg-white rounded-xl shadow-md overflow-hidden mb-3 border border-gray-200">\n                    <button onclick="toggleChange(${s})" class="w-full px-5 py-3 text-left flex items-center justify-between hover:bg-purple-50 transition-colors">\n                        <div class="flex items-center gap-3 flex-1">\n                            <span class="text-lg">üìå</span>\n                            <h4 class="text-lg font-semibold text-gray-800">${e.replace(/^###\s*/,"").trim()}</h4>\n                        </div>\n                        <svg id="change-icon-${s}" class="w-5 h-5 text-purple-600 transition-transform duration-300 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>\n                        </svg>\n                    </button>\n                    <div id="change-content-${s}" class="change-content-collapsible expanded">\n                        <div class="px-5 pb-4 space-y-3">\n            `,c=s}else if(e.match(/^\*\*Original(:|eel)?\*\*/i)){g+='\n                <div class="original-block">\n                    <span class="label-badge label-original">‚ùå Origineel</span>\n            ';let t=e.replace(/^\*\*Original(:|eel)?\*\*:?\s*/i,"").trim();t&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),g+=`<p class="text-gray-700 leading-relaxed text-sm">${t}</p>`)}else if(e.match(/^\*\*Verbeterd(:|e)?\*\*/i)||e.match(/^\*\*Improved(:|e)?\*\*/i)){g+='</div>\n                <div class="improved-block">\n                    <span class="label-badge label-improved">‚úÖ Verbeterd</span>\n            ';let t=e.replace(/^\*\*(Verbeterd(:|e)?|Improved(:|e)?)\*\*:?\s*/i,"").trim();t&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),g+=`<p class="text-gray-700 leading-relaxed text-sm">${t}</p>`)}else if(e.match(/^\*\*Why this (change )?matters(:|e)?\*\*/i)||e.match(/^\*\*Waarom(:|e)?\*\*/i)){g+='</div>\n                <div class="why-block">\n                    <span class="label-badge label-why">üí° Waarom dit belangrijk is</span>\n            ';let t=e.replace(/^\*\*(Why this (change )?matters(:|e)?|Waarom(:|e)?)\*\*:?\s*/i,"").trim();t&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),g+=`<p class="text-gray-700 leading-relaxed text-sm">${t}</p>`)}else if(e.match(/^\*\*Impact/i)){const t=(e.match(/‚≠ê/g)||[]).length;g+=`</div>\n                <div class="mt-3 flex items-center gap-2">\n                    <span class="text-gray-700 font-semibold text-sm">Impact:</span>\n                    <span class="star-rating text-xl">${"‚≠ê".repeat(t)}</span>\n                </div>\n            `}else e&&!e.match(/^---+$/)?(e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),g+=`<p class="text-gray-700 leading-relaxed text-sm">${e}</p>`):e.match(/^---+$/)&&null!==c&&(d+=`\n                                ${g}\n                            </div>\n                        </div>\n                    </div>\n                `,g="",c=null);null!==c&&(d+=`\n                            ${g}\n                        </div>\n                    </div>\n                </div>\n        `),null!==l&&(i+=`\n                        ${d}\n                    </div>\n                </div>\n            </div>\n        `,p[l]=m),t.innerHTML=i||'<p class="text-gray-400 italic">Geen wijzigingen gevonden</p>',console.log(`‚úÖ Changes rendered: ${a} sections, ${s} changes`),Object.keys(p).forEach(e=>{const t=p[e],n=document.getElementById(`section-count-${e}`);n&&(n.textContent=`${t} wijziging${1!==t?"en":""}`)}),console.log("‚úÖ Section counts updated:",p),setTimeout(()=>{const e=document.querySelectorAll(".change-card-collapsible"),t={ats:[],impact:[],polish:[],structure:[],targeting:[]};e.forEach((e,n)=>{const o=e.querySelector("h4")?.textContent||"",i=e.querySelector(".change-content-collapsible")?.textContent||"",a=e.closest('[id^="section-content-"]')?.previousElementSibling,r=categorizeChange(o,i,a?.querySelector("h2")?.textContent||"");t[r].push({title:o,content:i,index:n+1}),e.classList.add("category-group"),e.dataset.category=r}),updateCategoryScores(t),console.log("‚úÖ Category scores updated:",t)},500)}function toggleSection(e){const t=document.getElementById(`section-content-${e}`),n=document.getElementById(`section-icon-${e}`);t.classList.contains("expanded")?(t.classList.remove("expanded"),t.style.maxHeight="0px",n.classList.remove("rotate-180")):(t.classList.add("expanded"),t.style.maxHeight="5000px",n.classList.add("rotate-180"))}function toggleChange(e){const t=document.getElementById(`change-content-${e}`),n=document.getElementById(`change-icon-${e}`);t&&n&&(t.classList.contains("expanded")?(t.classList.remove("expanded"),n.classList.remove("rotate-180")):(t.classList.add("expanded"),n.classList.add("rotate-180")))}function collapseAllChanges(){const e=document.querySelectorAll('[id^="change-content-"], [id^="section-content-"]'),t=document.querySelectorAll('[id^="change-icon-"], [id^="section-icon-"]');e.forEach(e=>{e.classList.remove("expanded")}),t.forEach(e=>{e.classList.remove("rotate-180")}),console.log(`‚úÖ Collapsed ${e.length} items`),window.trackEvent&&window.trackEvent("collapse_all_clicked",{items_count:e.length})}function expandAllChanges(){const e=document.querySelectorAll('[id^="change-content-"], [id^="section-content-"]'),t=document.querySelectorAll('[id^="change-icon-"], [id^="section-icon-"]');e.forEach(e=>{e.classList.add("expanded")}),t.forEach(e=>{e.classList.add("rotate-180")}),console.log(`‚úÖ Expanded ${e.length} items`),window.trackEvent&&window.trackEvent("expand_all_clicked",{items_count:e.length})}function renderChangesContentOldFormat(e){console.log("üìú Rendering OLD flat format...");const t=document.getElementById("changesContent"),n=e.split("\n");let o="",i=0,a=null,r="";for(let e of n)if(e=e.trim(),e.match(/^###?\s*\d+\./)){null!==a&&(o+=`\n                            ${r}\n                        </div>\n                    </div>\n                </div>\n                `,r=""),i++;o+=`\n                <div class="change-card-collapsible bg-white rounded-xl shadow-lg overflow-hidden mb-4 border-2 border-gray-100">\n                    <button onclick="toggleChange(${i})" class="w-full px-6 py-4 text-left flex items-center justify-between hover:bg-purple-50 transition-colors">\n                        <div class="flex items-center gap-3 flex-1">\n                            <span class="text-2xl">üìù</span>\n                            <h3 class="text-xl font-bold text-gray-900">${e.replace(/^###?\s*/,"").trim()}</h3>\n                        </div>\n                        <svg id="change-icon-${i}" class="w-6 h-6 text-purple-600 transition-transform duration-300 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>\n                        </svg>\n                    </button>\n                    <div id="change-content-${i}" class="change-content-collapsible expanded">\n                        <div class="px-6 pb-6 space-y-4">\n            `,a=i}else if(e.match(/^\*\*Original(:|eel)?\*\*/i)){r+='\n                <div class="original-block">\n                    <span class="label-badge label-original">‚ùå Origineel</span>\n            ';let t=e.replace(/^\*\*Original(:|eel)?\*\*:?\s*/i,"").trim();t&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r+=`<p class="text-gray-700 leading-relaxed">${t}</p>`)}else if(e.match(/^\*\*Verbeterd(:|e)?\*\*/i)||e.match(/^\*\*Improved(:|e)?\*\*/i)||e.match(/^\*\*Nieuw(:|e)?\*\*/i)){r+='</div>\n                <div class="improved-block">\n                    <span class="label-badge label-improved">‚úÖ Verbeterd</span>\n            ';let t=e.replace(/^\*\*(Verbeterd(:|e)?|Improved(:|e)?|Nieuw(:|e)?)\*\*:?\s*/i,"").trim();t&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r+=`<p class="text-gray-700 leading-relaxed">${t}</p>`)}else if(e.match(/^\*\*Why|^\*\*Waarom/i)){r+='</div>\n                <div class="why-block">\n                    <span class="label-badge label-why">üí° Waarom dit belangrijk is</span>\n            ';let t=e.replace(/^\*\*(Why[^*]*|Waarom[^*]*)\*\*:?\s*/i,"").trim();t&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r+=`<p class="text-gray-700 leading-relaxed">${t}</p>`)}else if(e.match(/^\*\*Impact/i)){const t=(e.match(/‚≠ê/g)||[]).length;r+=`</div>\n                <div class="mt-4 flex items-center gap-2">\n                    <span class="text-gray-700 font-semibold">Impact:</span>\n                    <span class="star-rating">${"‚≠ê".repeat(t)}</span>\n                </div>\n            `}else!e||e.match(/^---+$/)||e.match(/^#{1,3}\s*üìä/)?e.match(/^---+$/)&&null!==a&&(o+=`\n                            ${r}\n                        </div>\n                    </div>\n                </div>\n                `,r="",a=null):(e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),r+=`<p class="text-gray-700 leading-relaxed">${e}</p>`);null!==a&&(o+=`\n                    ${r}\n                </div>\n            </div>\n        </div>\n        `),t.innerHTML=o||'<p class="text-gray-400 italic">Geen wijzigingen gevonden</p>',console.log(`‚úÖ OLD format rendered: ${i} changes`),setTimeout(()=>{const e=document.querySelectorAll(".change-card-collapsible"),t={ats:[],impact:[],polish:[],structure:[],targeting:[]};e.forEach((e,n)=>{const o=e.querySelector("h3")?.textContent||"",i=e.querySelector(".change-content-collapsible")?.textContent||"",a=categorizeChange(o,i);t[a].push({title:o,content:i,index:n+1});const r=categories[a].icon,s=e.querySelector(".text-2xl");s&&(s.textContent=r),e.classList.add("category-group"),e.dataset.category=a}),updateCategoryScores(t)},500)}function renderCVContent(e){if(!e)return;console.log("üé® Rendering CV content...");document.getElementById("improvedCV").textContent=e,console.log("‚úÖ CV content rendered")}function cleanAIResponse(e){if(!e)return e;const t=[/^Absoluut!?\s*Hier zijn.*?(?=\n\n|$)/i,/^Natuurlijk!?\s*Hier.*?(?=\n\n|$)/i,/^Zeker!?\s*Hier.*?(?=\n\n|$)/i,/^Uiteraard!?\s*Hier.*?(?=\n\n|$)/i,/^Ok√©!?\s*Hier.*?(?=\n\n|$)/i,/^Prima!?\s*Hier.*?(?=\n\n|$)/i,/^Hier zijn.*?CV van.*?opgesteld.*?(?=\n\n|$)/i,/^Hier zijn.*?gedetailleerde.*?verbeteringen.*?(?=\n\n|$)/i,/^Hieronder vind je.*?(?=\n\n|###|Origineel:|$)/i,/^(?:Absoluut|Natuurlijk|Zeker|Uiteraard).*?(?:Hier is|Hier zijn).*?(?=\n\n|###|\d+\.)/is,/^Absolutely!?\s*Here.*?(?=\n\n|$)/i,/^Of course!?\s*Here.*?(?=\n\n|$)/i,/^Sure!?\s*Here.*?(?=\n\n|$)/i];let n=e;for(const e of t)n=n.replace(e,"");return n.trim()}async function renderMarkdownContent(e,t){if(!t)return;console.log(`üé® Rendering ${e}...`);const n=document.getElementById(e);try{await window.loadMarked();const o=cleanAIResponse(t);n.innerHTML=marked.parse(o),console.log(`‚úÖ Rendered ${e}`)}catch(o){console.error(`‚ùå Error rendering ${e}:`,o),n.textContent=t}}async function renderRecruiterTipsChecklist(e){if(!e)return;console.log("üé® Rendering Recruiter Tips as checklist..."),await window.loadMarked();const t=cleanAIResponse(e);document.getElementById("recruiterTips").innerHTML=marked.parse(t);const n=document.getElementById("recruiterTipsChecklist");n.innerHTML="";const o=t.split(/(?=#{2,3}\s)/);let i=0,a=0;o.forEach((e,t)=>{if(!e.trim())return;const r=e.match(/^#{2,3}\s+(.+?)$/m),s=r?r[1].trim():`Categorie ${t+1}`,l=e.split("\n"),c=[];let d="";for(let e of l)e.match(/^[\*\-]\s+/)?(d&&c.push(d.trim()),d=e):d&&e.trim()&&!e.match(/^#{1,3}\s/)&&(d+=" "+e.trim());if(d&&c.push(d.trim()),0===c.length)return;a++;const g=`tips-section-${a}`,m=document.createElement("div");m.style.cssText="\n            background: linear-gradient(135deg, #ffffff 0%, #fffbeb 50%, #fef3c7 100%);\n            border: 2px solid;\n            border-image: linear-gradient(135deg, #f59e0b, #fbbf24, #f59e0b) 1;\n            border-radius: 16px;\n            box-shadow: 0 10px 40px rgba(251, 191, 36, 0.15), 0 0 0 1px rgba(251, 191, 36, 0.1) inset;\n            position: relative;\n            overflow: hidden;\n            margin-bottom: 1rem;\n        ";const p=document.createElement("div");p.style.cssText="\n            position: absolute;\n            top: -50%;\n            left: -50%;\n            width: 200%;\n            height: 200%;\n            background: radial-gradient(circle, rgba(251,191,36,0.08) 0%, transparent 70%);\n            pointer-events: none;\n            z-index: 0;\n        ",m.appendChild(p);const u=document.createElement("button");u.onclick=()=>toggleTipsSection(g),u.style.cssText="\n            width: 100%;\n            padding: 1.5rem 2rem;\n            font-size: 1.375rem;\n            font-weight: 800;\n            background: transparent;\n            border: none;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            gap: 0.75rem;\n            position: relative;\n            z-index: 1;\n            transition: all 0.3s ease;\n        ",u.innerHTML=`\n            <div style="display: flex; align-items: center; gap: 0.75rem;">\n                <span style="font-size: 1.5rem; filter: drop-shadow(0 2px 4px rgba(251,191,36,0.3));">üíé</span>\n                <span style="background: linear-gradient(135deg, #b45309 0%, #f59e0b 50%, #fbbf24 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${s}</span>\n            </div>\n            <svg id="${g}-icon" style="width: 1.5rem; height: 1.5rem; color: #f59e0b; transition: transform 0.3s ease; transform: rotate(0deg);" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>\n            </svg>\n        `,m.appendChild(u);const h=document.createElement("div");h.id=g,h.style.cssText="\n            max-height: 0;\n            overflow: hidden;\n            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n            padding: 0 2rem;\n        ";const y=document.createElement("div");y.style.cssText="\n            display: flex;\n            flex-direction: column;\n            gap: 1rem;\n            position: relative;\n            z-index: 1;\n            padding-bottom: 2rem;\n        ",c.forEach((e,n)=>{let r=e.replace(/^[\*\-]\s+/,"").trim();r=r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");const s=`tip-${a}-${n}`;if(i++,9===i){const e=document.createElement("div");return e.style.cssText="\n                    padding: 2rem;\n                    background: linear-gradient(135deg, #7c3aed 0%, #c026d3 100%);\n                    border-radius: 16px;\n                    color: white;\n                    text-align: center;\n                    box-shadow: 0 20px 60px rgba(124, 58, 237, 0.4);\n                    position: relative;\n                    overflow: hidden;\n                    margin: 2rem 0;\n                ",e.innerHTML=`\n                    <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); pointer-events: none;"></div>\n\n                    <div style="position: relative; z-index: 1;">\n                        <div style="font-size: 4rem; margin-bottom: 1rem;">üîí</div>\n                        <h3 style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.75rem;">\n                            Unlock ${c.length-8+6*(o.length-t-1)} Meer Premium Tips\n                        </h3>\n                        <p style="font-size: 1.125rem; opacity: 0.95; margin-bottom: 1.5rem; max-width: 500px; margin-left: auto; margin-right: auto;">\n                            Krijg toegang tot alle insider recruiter tips, STAR-vragen en interview strategie√´n speciaal voor deze functie\n                        </p>\n\n                        <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1.5rem; flex-wrap: wrap;">\n                            <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 999px; backdrop-filter: blur(10px);">\n                                <span style="font-weight: 700;">‚úì</span> Volledige STAR vragenbank\n                            </div>\n                            <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 999px; backdrop-filter: blur(10px);">\n                                <span style="font-weight: 700;">‚úì</span> Competentie vragen\n                            </div>\n                            <div style="background: rgba(255,255,255,0.2); padding: 0.75rem 1.25rem; border-radius: 999px; backdrop-filter: blur(10px);">\n                                <span style="font-weight: 700;">‚úì</span> Do's & Don'ts\n                            </div>\n                        </div>\n\n                        <button onclick="alert('Premium upgrade coming soon! Contact us for early access.')" style="\n                            background: white;\n                            color: #7c3aed;\n                            padding: 1rem 3rem;\n                            border-radius: 12px;\n                            font-size: 1.125rem;\n                            font-weight: 700;\n                            border: none;\n                            cursor: pointer;\n                            transition: all 0.3s;\n                            box-shadow: 0 8px 24px rgba(0,0,0,0.15);\n                        ">\n                            üíé Upgrade naar Premium - ‚Ç¨9.99\n                        </button>\n\n                        <div style="margin-top: 1.5rem; font-size: 0.875rem; opacity: 0.8;">\n                            ‚è∞ Limited time: Get 30% off with code <strong style="background: rgba(255,255,255,0.2); padding: 0.25rem 0.5rem; border-radius: 4px;">FIRSTJOB30</strong>\n                        </div>\n                    </div>\n                `,void y.appendChild(e)}const l=document.createElement("div");l.style.cssText="\n                display: flex;\n                align-items: flex-start;\n                gap: 1rem;\n                padding: 1.25rem;\n                background: linear-gradient(135deg, #ffffff 0%, #fefce8 100%);\n                border: 1.5px solid rgba(251, 191, 36, 0.2);\n                border-radius: 12px;\n                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n                cursor: pointer;\n                box-shadow: 0 2px 8px rgba(251, 191, 36, 0.08);\n                position: relative;\n                overflow: hidden;\n            ",l.addEventListener("mouseenter",()=>{l.style.transform="translateY(-2px) scale(1.01)",l.style.boxShadow="0 8px 24px rgba(251, 191, 36, 0.2), 0 0 0 2px rgba(251, 191, 36, 0.15)",l.style.borderColor="rgba(251, 191, 36, 0.4)"}),l.addEventListener("mouseleave",()=>{l.style.transform="",l.style.boxShadow="0 2px 8px rgba(251, 191, 36, 0.08)",l.style.borderColor="rgba(251, 191, 36, 0.2)"});const d=document.createElement("input");d.type="checkbox",d.id=s,d.style.cssText="\n                width: 24px;\n                height: 24px;\n                margin-top: 0.125rem;\n                cursor: pointer;\n                accent-color: #f59e0b;\n                flex-shrink: 0;\n                filter: drop-shadow(0 2px 4px rgba(251, 191, 36, 0.2));\n                transition: all 0.2s ease;\n            ",d.addEventListener("change",function(){updateTipsProgress(),this.checked?(l.style.background="linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",l.style.borderColor="rgba(34, 197, 94, 0.3)",g.style.color="#166534",g.style.textDecoration="line-through",g.style.opacity="0.6"):(l.style.background="linear-gradient(135deg, #ffffff 0%, #fefce8 100%)",l.style.borderColor="rgba(251, 191, 36, 0.2)",g.style.color="#374151",g.style.textDecoration="none",g.style.opacity="1")});const g=document.createElement("label");g.htmlFor=s,g.style.cssText="\n                font-size: 1rem;\n                line-height: 1.7;\n                color: #374151;\n                cursor: pointer;\n                flex: 1;\n                font-weight: 500;\n                transition: all 0.3s ease;\n            ",g.innerHTML=r,l.addEventListener("click",e=>{e.target!==d&&"LABEL"!==e.target.tagName&&(d.checked=!d.checked,d.dispatchEvent(new Event("change")))}),l.appendChild(d),l.appendChild(g),y.appendChild(l)}),h.appendChild(y),m.appendChild(h),n.appendChild(m),1===a&&setTimeout(()=>toggleTipsSection(g),100)}),document.getElementById("total-count").textContent=i,updateTipsProgress(),console.log(`‚úÖ Rendered ${i} checklist items in ${a} sections`)}function toggleTipsSection(e){const t=document.getElementById(e),n=document.getElementById(`${e}-icon`);t&&n&&(t.style.maxHeight&&"0px"!==t.style.maxHeight?(t.style.maxHeight="0px",n.style.transform="rotate(0deg)"):(t.style.maxHeight=t.scrollHeight+"px",n.style.transform="rotate(180deg)"))}function updateTipsProgress(){const e=document.querySelectorAll('#recruiterTipsChecklist input[type="checkbox"]'),t=Array.from(e).filter(e=>e.checked).length,n=e.length;document.getElementById("completed-count").textContent=t,document.getElementById("total-count").textContent=n;const o=document.getElementById("tips-progress");t===n&&n>0?(o.style.background="linear-gradient(135deg, #10b981 0%, #059669 100%)",o.style.color="white",window.trackEvent&&window.trackEvent("all_tips_checked",{total_tips:n})):(o.style.background="white",o.style.color="#f59e0b")}async function downloadPDF(){const e=window.rateLimiter?.getStatus()||{unlimited:!1};let t={whitelisted:!1,unlimited:!1,devMode:!1};try{const e=localStorage.getItem("rateLimitServerStatus");e&&(t=JSON.parse(e))}catch(e){console.error("Error parsing server status:",e)}const n=t.devMode||!1,o=n||e.unlimited||t.whitelisted;window.trackEvent&&window.trackEvent("pdf_download_attempted",{status:"initiated",user_type:o?"premium":"free",method:o?"server_pdf":"browser_print",is_dev:n}),o?await downloadProfessionalPDF():downloadBrowserPDF()}async function downloadProfessionalPDF(){const e=document.createElement("div");e.id="pdf-loading",e.style.cssText="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #6366F1, #8B5CF6); color: white; padding: 1.5rem 2.5rem; border-radius: 16px; box-shadow: 0 10px 40px rgba(99,102,241,0.4); z-index: 10000; font-weight: bold; text-align: center;",e.innerHTML='‚öôÔ∏è Generating professional PDF...<br><small style="font-weight: normal; opacity: 0.9;">This will take a few seconds</small>',document.body.appendChild(e);try{const t=JSON.parse(sessionStorage.getItem("cvAnalysisResult")||"{}"),n=extractMatchScore(),o=!t.changesOverview&&!t.improvedCV,i={matchScore:n||(o?85:75),changesOverview:t.changesOverview||(o?"Demo: This is a sample CV analysis for testing the PDF generation.":""),improvedCV:t.improvedCV||(o?"Demo Improved CV\n\nThis is sample improved CV text for testing PDF generation in developer mode.":""),coverLetter:t.coverLetter||(o?"Demo Cover Letter\n\nDear Hiring Manager,\n\nThis is a sample cover letter for testing.":""),recruiterTips:t.recruiterTips||(o?"Demo Recruiter Tips\n\n1. Keep your CV concise\n2. Use action verbs\n3. Quantify achievements":""),isPremium:!0,language:t.language||"nl"};console.log("üì§ Sending PDF generation request...");const a=await fetch("/.netlify/functions/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok)throw new Error(`PDF generation failed: ${a.statusText}`);const r=await a.blob();console.log("üìÑ PDF received:",r.size,"bytes");const s=window.URL.createObjectURL(r),l=document.createElement("a");l.href=s,l.download=`CV-Analysis-${Date.now()}.pdf`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(s),l.remove(),e.style.background="linear-gradient(135deg, #10B981, #059669)",e.innerHTML='‚úÖ Professional PDF downloaded!<br><small style="font-weight: normal; opacity: 0.9;">Check your downloads folder</small>',setTimeout(()=>e.remove(),3e3),window.trackEvent&&window.trackEvent("pdf_download_completed",{method:"server_pdf",user_type:"premium",file_size:r.size})}catch(t){console.error("‚ùå PDF generation error:",t),e.style.background="linear-gradient(135deg, #EF4444, #DC2626)",e.innerHTML='‚ùå PDF generation failed<br><small style="font-weight: normal; opacity: 0.9;">Falling back to browser print...</small>',setTimeout(()=>{e.remove(),downloadBrowserPDF()},2e3),window.trackEvent&&window.trackEvent("pdf_download_error",{error:t.message,method:"server_pdf"})}}function downloadBrowserPDF(){const e=[];["sticky-upgrade-bar","sticky-download-btn","exit-intent-popup","feature-comparison","testimonial-slider","next-steps-cta","faq-section","progress-indicator","last-upgrade-counter","journey-cta"].forEach(t=>{const n=document.getElementById(t);n&&"none"!==n.style.display&&(n.dataset.originalDisplay=n.style.display||"",n.style.display="none",e.push(n))}),document.querySelectorAll(".unlock-overlay").forEach(t=>{t.dataset.originalDisplay=t.style.display||"",t.style.display="none",e.push(t)}),document.querySelectorAll(".blur-content").forEach(t=>{t.dataset.originalFilter=t.style.filter||"",t.style.filter="none",e.push(t)});const t=document.createElement("div");t.id="print-message",t.style.cssText="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10000; font-weight: bold; text-align: center;",t.innerHTML='üìÑ Print dialog opening...<br><small style="font-weight: normal;">Choose "Save as PDF" in the print dialog</small>',document.body.appendChild(t),setTimeout(()=>{window.print(),setTimeout(()=>{e.forEach(e=>{e.classList&&e.classList.contains("blur-content")?e.style.filter=e.dataset.originalFilter||"":(e.classList&&e.classList.contains("unlock-overlay"),e.style.display=e.dataset.originalDisplay||"")});const t=document.getElementById("print-message");t&&t.remove(),window.trackEvent&&window.trackEvent("pdf_download_completed",{method:"browser_print",user_type:"free"})},1e3)},100)}function extractMatchScore(){const e=document.querySelector('[id*="matchScore"]')?.textContent;if(e){const t=e.match(/(\d+)%/);return t?parseInt(t[1]):null}return null}function copyCV(){const e=document.getElementById("improvedCV").textContent;navigator.clipboard.writeText(e).then(()=>{window.trackEvent&&window.trackEvent("cv_copied",{content_length:e.length});const t=event.target.closest("button"),n=t.innerHTML;t.innerHTML='<span class="text-2xl">‚úÖ</span> Gekopieerd!',t.classList.add("bg-green-600","hover:bg-green-700"),t.classList.remove("bg-blue-600","hover:bg-blue-700"),setTimeout(()=>{t.innerHTML=n,t.classList.remove("bg-green-600","hover:bg-green-700"),t.classList.add("bg-blue-600","hover:bg-blue-700")},2e3)}).catch(e=>{console.error("‚ùå Error copying:",e),window.trackEvent&&window.trackEvent("cv_copy_error",{error_message:e.message}),alert("‚ùå Kon CV niet kopi√´ren")})}function scrollToInterview(){const e=document.getElementById("interview-section");if(e){const t=100,n=e.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:n,behavior:"smooth"}),setTimeout(()=>{const e=document.getElementById("tips-content");e&&"0px"===e.style.maxHeight&&toggleMainSection("tips")},300),window.trackEvent&&window.trackEvent("interview_section_viewed",{source:"button_click"})}}let currentLanguage="nl",originalContent={},translatedContent={};function saveOriginalContent(){originalContent={title:document.getElementById("mainTitle")?.textContent,cv:document.getElementById("improvedCV")?.innerHTML,cover:document.getElementById("coverLetter")?.innerHTML,tips:document.getElementById("recruiterTips")?.innerHTML,changes:document.getElementById("changesOverview")?.innerHTML},console.log("üíæ Original content saved")}function showNotification(e,t="info"){const n=document.createElement("div");n.className="fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-semibold z-50 transition-all duration-300 "+("success"===t?"bg-green-500":"error"===t?"bg-red-500":"bg-blue-500"),n.textContent=e,n.style.transform="translateY(100px)",n.style.opacity="0",document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateY(0)",n.style.opacity="1"},10),setTimeout(()=>{n.style.transform="translateY(100px)",n.style.opacity="0",setTimeout(()=>n.remove(),300)},3e3)}function openEmailModal(){document.getElementById("emailModal").classList.remove("hidden"),document.getElementById("emailCaptureForm").classList.remove("hidden"),document.getElementById("emailSuccess").classList.add("hidden")}function closeEmailModal(){document.getElementById("emailModal").classList.add("hidden"),document.getElementById("emailCaptureForm").reset()}async function submitEmail(e){e.preventDefault();const t=document.getElementById("userEmail").value,n=document.getElementById("userName").value,o=document.getElementById("newsletter").checked,i=sessionStorage.getItem("cvAnalysisResult");if(!i)return void showNotification("‚ùå No results found. Please analyze your CV first.","error");const a=JSON.parse(i),r=e.target.querySelector('button[type="submit"]'),s=r.innerHTML;r.innerHTML="‚è≥ Sending...",r.disabled=!0;try{if(!(await fetch("/.netlify/functions/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,name:n,newsletter:o,cvResults:{improvedCV:a.improvedCV,coverLetter:a.coverLetter,recruiterTips:a.recruiterTips,changesOverview:a.changesOverview}})})).ok)throw new Error("Failed to send email");document.getElementById("emailCaptureForm").classList.add("hidden"),document.getElementById("emailSuccess").classList.remove("hidden"),localStorage.setItem("userEmail",t),n&&localStorage.setItem("userName",n),showNotification("‚úÖ Results sent to your inbox!","success")}catch(e){console.error("‚ùå Email send error:",e),showNotification("‚ùå Failed to send email. Please try again.","error"),r.innerHTML=s,r.disabled=!1}}function copyCoverLetter(){const e=document.getElementById("coverLetter").innerText;navigator.clipboard.writeText(e).then(()=>{showNotification("‚úÖ Aanbevelingsbrief gekopieerd!","success"),window.trackEvent&&window.trackEvent("cover_letter_copied",{})}).catch(e=>{console.error("Failed to copy:",e),showNotification("‚ùå Kopi√´ren mislukt. Probeer opnieuw.","error")})}function downloadCoverLetterPDF(){const e=document.getElementById("coverLetter").innerText,t=new Blob([e],{type:"text/plain"}),n=window.URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download="aanbevelingsbrief.txt",document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o),showNotification("‚úÖ Aanbevelingsbrief gedownload!","success"),window.trackEvent&&window.trackEvent("cover_letter_downloaded",{format:"txt"})}function toggleMainSection(e){const t=document.getElementById(`${e}-content`),n=document.getElementById(`${e}-icon`),o=t.previousElementSibling;t.classList.contains("expanded")?(t.classList.remove("expanded"),n.classList.remove("rotated"),o.classList.remove("active")):(t.classList.add("expanded"),n.classList.add("rotated"),o.classList.add("active"))}function checkCookieConsent(){const e=localStorage.getItem("cookieConsent"),t=document.getElementById("cookieConsent");e||setTimeout(()=>{t.classList.add("show")},1e3)}function acceptCookies(){localStorage.setItem("cookieConsent","accepted"),localStorage.setItem("cookieConsentDate",(new Date).toISOString()),document.getElementById("cookieConsent").classList.remove("show"),showNotification("‚úÖ Cookie preferences saved","success")}function declineCookies(){localStorage.setItem("cookieConsent","declined"),localStorage.setItem("cookieConsentDate",(new Date).toISOString()),document.getElementById("cookieConsent").classList.remove("show"),showNotification("‚úÖ Cookie preferences saved","success")}window.addEventListener("DOMContentLoaded",()=>{saveOriginalContent()}),document.getElementById("emailModal")?.addEventListener("click",function(e){"emailModal"===e.target.id&&closeEmailModal()}),checkCookieConsent(),window.downloadPDF=downloadPDF,window.openEmailModal=openEmailModal,window.closeEmailModal=closeEmailModal,window.scrollToInterview=scrollToInterview,window.toggleCategory=toggleCategory,window.toggleMainSection=toggleMainSection,window.copyCoverLetter=copyCoverLetter,window.downloadCoverLetterPDF=downloadCoverLetterPDF,window.acceptCookies=acceptCookies,window.declineCookies=declineCookies;